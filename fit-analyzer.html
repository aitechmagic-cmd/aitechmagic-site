<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Fit Analyzer | AI Tech Magic</title>
  <meta name="description" content="Paste a job description and our AI will analyze it against Virginia's expertise in AI/ML leadership, strategy, and governance." />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --coral: #E8784A;
      --coral-light: #F09A76;
      --coral-dark: #D4612E;
      --slate: #2D3E50;
      --slate-dark: #1E2D3D;
      --cream: #FAF7F4;
      --white: #ffffff;
      --text: #2D3E50;
      --text-light: #5A6B7D;
      --text-muted: #8A96A3;
      --border: rgba(45,62,80,0.1);
      --border-med: rgba(45,62,80,0.15);
      --success: #3A8F6E;
      --success-bg: rgba(58,143,110,0.08);
      --warning: #C4873B;
      --warning-bg: rgba(196,135,59,0.08);
      --gap-color: #B85450;
      --gap-bg: rgba(184,84,80,0.06);
    }

    body {
      font-family: 'Source Serif 4', 'Source Serif Pro', Georgia, serif;
      background: var(--cream);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .ambient-glow {
      position: fixed; top: -150px; right: -150px; width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(232,120,74,0.06) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    .container {
      max-width: 680px; margin: 0 auto; padding: 48px 24px;
      padding-top: 100px;
      position: relative; z-index: 1;
      transition: padding-bottom 0.3s;
    }
    .container.chat-open { padding-bottom: 420px; }

    /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
    .header { text-align: center; margin-bottom: 44px; }
    .brand-tag {
      display: inline-flex; align-items: center; gap: 10px; margin-bottom: 20px;
    }
    .brand-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--coral); box-shadow: 0 0 10px rgba(232,120,74,0.5);
      animation: pulse 2.5s infinite;
    }
    .brand-label {
      font-family: 'Outfit', sans-serif; font-size: 12px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 3.5px; color: var(--text-muted);
    }
    .header h1 {
      font-family: 'Outfit', sans-serif; font-size: clamp(28px, 5vw, 42px);
      font-weight: 700; line-height: 1.15; margin-bottom: 16px; color: var(--slate);
    }
    .header p {
      font-size: 16px; color: var(--text-light); max-width: 460px;
      margin: 0 auto; line-height: 1.7;
    }

    /* ‚îÄ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ */
    .card {
      background: var(--white); border: 1px solid var(--border-med);
      border-radius: 14px; padding: 22px; margin-bottom: 16px;
      box-shadow: 0 2px 12px rgba(45,62,80,0.04);
    }
    .card.pad-lg { padding: 28px; }

    .section-label {
      font-family: 'Outfit', sans-serif; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 2px; margin-bottom: 14px;
      display: flex; align-items: center; gap: 8px;
    }
    .section-label .dot {
      width: 8px; height: 8px; border-radius: 50%;
    }

    /* ‚îÄ‚îÄ‚îÄ Textarea ‚îÄ‚îÄ‚îÄ */
    .input-area textarea {
      width: 100%; background: var(--cream); border: 1px solid var(--border);
      border-radius: 10px; padding: 16px; color: var(--text);
      font-size: 14px; line-height: 1.75; resize: vertical; outline: none;
      font-family: 'Source Serif 4', Georgia, serif; transition: border-color 0.2s;
    }
    .input-area textarea:focus { border-color: var(--coral); }
    .input-area textarea::placeholder { color: var(--text-muted); }
    .input-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; }
    .word-count { font-size: 12px; color: var(--text-muted); }

    /* ‚îÄ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ‚îÄ */
    .btn-primary {
      padding: 13px 32px; border-radius: 10px; border: none;
      background: var(--coral); color: #fff; font-size: 14px; font-weight: 600;
      cursor: pointer; font-family: 'Outfit', sans-serif;
      box-shadow: 0 4px 16px rgba(232,120,74,0.3); transition: all 0.3s;
    }
    .btn-primary:disabled {
      background: var(--border); color: var(--text-muted);
      box-shadow: none; cursor: default;
    }
    .btn-secondary {
      padding: 14px 28px; border-radius: 10px; background: transparent;
      border: 1px solid var(--border-med); color: var(--text-light);
      font-size: 13px; cursor: pointer; font-family: 'Outfit', sans-serif;
      transition: all 0.2s;
    }
    .btn-secondary:hover { border-color: var(--coral); color: var(--coral); }

    /* ‚îÄ‚îÄ‚îÄ Fit Meter ‚îÄ‚îÄ‚îÄ */
    .fit-meter { display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .fit-label {
      font-size: 12px; color: var(--coral); text-transform: uppercase;
      letter-spacing: 2.5px; font-family: 'Outfit', sans-serif; font-weight: 600;
    }
    .fit-headline {
      font-size: 18px; font-weight: 500; color: var(--slate);
      margin-top: 16px; line-height: 1.55; max-width: 480px;
      text-align: center; font-style: italic;
    }

    /* ‚îÄ‚îÄ‚îÄ Skill Tags ‚îÄ‚îÄ‚îÄ */
    .skill-tags { display: flex; flex-wrap: wrap; gap: 8px; }
    .skill-tag {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; border-radius: 20px; font-size: 13px;
    }
    .skill-tag .dot { width: 6px; height: 6px; border-radius: 50%; }
    .skill-tag.strong { background: var(--success-bg); border: 1px solid rgba(58,143,110,0.25); color: var(--success); }
    .skill-tag.strong .dot { background: var(--success); }
    .skill-tag.partial { background: var(--warning-bg); border: 1px solid rgba(196,135,59,0.25); color: var(--warning); }
    .skill-tag.partial .dot { background: var(--warning); }
    .skill-tag.gap { background: var(--gap-bg); border: 1px solid rgba(184,84,80,0.2); color: var(--gap-color); }
    .skill-tag.gap .dot { background: var(--gap-color); }

    /* ‚îÄ‚îÄ‚îÄ Match Items ‚îÄ‚îÄ‚îÄ */
    .match-item {
      padding: 14px 16px; border-radius: 10px; margin-bottom: 10px;
    }
    .match-item:last-child { margin-bottom: 0; }
    .match-item.strong { background: var(--success-bg); border-left: 3px solid var(--success); }
    .match-item.partial { background: var(--warning-bg); border-left: 3px solid var(--warning); }
    .match-item.gap { background: var(--gap-bg); }
    .match-item h4 {
      font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600;
      color: var(--slate); margin-bottom: 4px;
    }
    .match-item p { font-size: 13px; color: var(--text-light); line-height: 1.65; }

    .cta-box {
      padding: 14px 18px; border-radius: 10px;
      background: linear-gradient(135deg, rgba(232,120,74,0.06), rgba(45,62,80,0.03));
      border: 1px solid rgba(232,120,74,0.2);
      font-size: 14px; color: var(--coral); font-weight: 500;
      font-family: 'Outfit', sans-serif;
    }

    .action-buttons {
      display: flex; gap: 12px; justify-content: center;
      padding-top: 8px; flex-wrap: wrap;
    }

    /* ‚îÄ‚îÄ‚îÄ Loading ‚îÄ‚îÄ‚îÄ */
    .loading { text-align: center; padding: 60px 0; }
    .spinner {
      width: 44px; height: 44px; border-radius: 50%;
      border: 3px solid var(--border); border-top-color: var(--coral);
      animation: spin 0.8s linear infinite; margin: 0 auto 20px;
    }
    .loading p { color: var(--text-muted); font-size: 14px; font-family: 'Outfit', sans-serif; }

    .error-msg {
      padding: 16px 20px; border-radius: 10px; background: var(--gap-bg);
      border: 1px solid rgba(184,84,80,0.2); color: var(--gap-color);
      font-size: 14px; margin-bottom: 20px;
    }

    /* ‚îÄ‚îÄ‚îÄ Chat Panel ‚îÄ‚îÄ‚îÄ */
    .chat-panel {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--white); border-top: 2px solid var(--coral);
      display: flex; flex-direction: column; height: 400px; z-index: 1000;
      animation: slideUp 0.3s ease-out;
    }
    .chat-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 14px 20px; border-bottom: 1px solid var(--border); flex-shrink: 0;
    }
    .chat-header-left { display: flex; align-items: center; gap: 10px; }
    .chat-avatar {
      width: 34px; height: 34px; border-radius: 50%;
      background: linear-gradient(135deg, var(--coral), var(--coral-dark));
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; font-weight: 700; color: #fff; font-family: 'Outfit', sans-serif;
    }
    .chat-avatar.sm { width: 30px; height: 30px; font-size: 13px; }
    .chat-title { font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 600; color: var(--slate); }
    .chat-subtitle { font-size: 11px; color: var(--text-muted); }
    .chat-minimize {
      background: var(--cream); border: 1px solid var(--border);
      border-radius: 8px; padding: 6px 14px; color: var(--text-muted);
      cursor: pointer; font-size: 12px; font-family: 'Outfit', sans-serif;
    }
    .chat-messages {
      flex: 1; overflow-y: auto; padding: 16px 20px; background: var(--cream);
      display: flex; flex-direction: column;
    }
    .chat-bubble-row { display: flex; margin-bottom: 12px; animation: fadeIn 0.3s ease-out; }
    .chat-bubble-row.user { justify-content: flex-end; }
    .chat-bubble-row.assistant { justify-content: flex-start; }
    .chat-bubble {
      max-width: 80%; padding: 12px 16px; font-size: 14px; line-height: 1.65;
    }
    .chat-bubble.user {
      background: rgba(45,62,80,0.06); border: 1px solid var(--border);
      border-radius: 14px 14px 4px 14px;
    }
    .chat-bubble.assistant {
      background: rgba(232,120,74,0.06); border: 1px solid rgba(232,120,74,0.15);
      border-radius: 14px 14px 14px 4px;
    }
    .typing-dots { display: flex; gap: 5px; padding: 14px 18px; }
    .typing-dots span {
      width: 6px; height: 6px; border-radius: 50%; background: var(--coral); opacity: 0.5;
    }
    .typing-dots span:nth-child(1) { animation: bounce 1.2s ease-in-out 0s infinite; }
    .typing-dots span:nth-child(2) { animation: bounce 1.2s ease-in-out 0.15s infinite; }
    .typing-dots span:nth-child(3) { animation: bounce 1.2s ease-in-out 0.3s infinite; }

    .suggested-qs { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 4px; }
    .suggested-q {
      padding: 8px 14px; border-radius: 20px; font-size: 12px;
      background: var(--white); border: 1px solid var(--border);
      color: var(--text-light); cursor: pointer;
      font-family: 'Source Serif 4', Georgia, serif; transition: all 0.2s;
    }
    .suggested-q:hover { border-color: var(--coral); color: var(--coral); }

    .chat-input-row {
      padding: 12px 20px 16px; border-top: 1px solid var(--border);
      display: flex; gap: 10px; flex-shrink: 0; background: var(--white);
    }
    .chat-input {
      flex: 1; padding: 12px 16px; border-radius: 10px;
      background: var(--cream); border: 1px solid var(--border);
      color: var(--text); font-size: 14px; outline: none;
      font-family: 'Source Serif 4', Georgia, serif; transition: border-color 0.2s;
    }
    .chat-input:focus { border-color: var(--coral); }
    .chat-input::placeholder { color: var(--text-muted); }
    .chat-send {
      padding: 12px 22px; border-radius: 10px; border: none;
      font-size: 14px; font-weight: 600; font-family: 'Outfit', sans-serif;
      cursor: pointer; transition: all 0.2s;
    }
    .chat-send.active { background: var(--coral); color: #fff; }
    .chat-send.inactive { background: var(--border); color: var(--text-muted); cursor: default; }

    /* ‚îÄ‚îÄ‚îÄ Chat FAB ‚îÄ‚îÄ‚îÄ */
    .chat-fab {
      position: fixed; bottom: 24px; right: 24px;
      width: 56px; height: 56px; border-radius: 50%; border: none;
      background: linear-gradient(135deg, var(--coral), var(--coral-dark));
      color: #fff; font-size: 22px; cursor: pointer;
      box-shadow: 0 4px 20px rgba(232,120,74,0.35);
      display: flex; align-items: center; justify-content: center;
      z-index: 999; animation: fadeIn 0.3s ease-out;
    }

    /* ‚îÄ‚îÄ‚îÄ Utility ‚îÄ‚îÄ‚îÄ */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-16 { margin-top: 16px; }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-5px); } }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav style="position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(250,250,248,0.93);backdrop-filter:blur(10px);border-bottom:1px solid rgba(45,62,80,0.1);padding:16px 0;">
    <div style="max-width:1200px;margin:0 auto;padding:0 32px;display:flex;justify-content:space-between;align-items:center;">
      <a href="/" style="font-family:'Outfit',sans-serif;font-size:1.5rem;font-weight:700;color:#2D3E50;text-decoration:none;">AI Tech <span style="color:#E8784A;">Magic</span></a>
      <ul style="display:flex;gap:32px;list-style:none;">
        <li><a href="/#services" style="font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:500;color:#1A1A1A;text-decoration:none;">Services</a></li>
        <li><a href="/#about" style="font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:500;color:#1A1A1A;text-decoration:none;">About</a></li>
        <li><a href="/fit-analyzer.html" style="font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:500;color:#E8784A;text-decoration:none;">Job Fit Tool</a></li>
        <li><a href="/#contact" style="font-family:'Outfit',sans-serif;font-size:0.95rem;font-weight:500;color:#1A1A1A;text-decoration:none;">Contact</a></li>
      </ul>
    </div>
  </nav>
  <div class="ambient-glow"></div>

  <div class="container" id="container">
    <!-- Header -->
    <div class="header">
      <div class="brand-tag">
        <div class="brand-dot"></div>
        <span class="brand-label">AI Tech Magic</span>
      </div>
      <h1>Is Virginia the right fit<br>for your role?</h1>
      <p>Paste a job description below and our AI will analyze it against Virginia's expertise in AI/ML leadership, strategy, and governance.</p>
    </div>

    <!-- Input Phase -->
    <div id="input-phase">
      <div class="card pad-lg input-area">
        <label class="section-label" style="color: var(--text-muted);">Paste Job Description</label>
        <textarea id="job-desc" rows="10" placeholder="Paste the full job description here..."></textarea>
        <div class="input-footer">
          <span class="word-count" id="word-count"></span>
          <button class="btn-primary" id="analyze-btn" disabled>Analyze Fit ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- Loading Phase -->
    <div id="loading-phase" class="hidden">
      <div class="loading">
        <div class="spinner"></div>
        <p>Mapping requirements to experience...</p>
      </div>
    </div>

    <!-- Error -->
    <div id="error-msg" class="error-msg hidden"></div>

    <!-- Results Phase -->
    <div id="results-phase" class="hidden" style="animation: fadeIn 0.5s ease-out;">
      <!-- Score -->
      <div class="card pad-lg text-center" id="score-card"></div>
      <!-- Skills -->
      <div class="card" id="skills-card"></div>
      <!-- Strengths -->
      <div class="card" id="strengths-card"></div>
      <!-- Partial -->
      <div class="card" id="partial-card"></div>
      <!-- Gaps -->
      <div class="card" id="gaps-card"></div>
      <!-- Summary -->
      <div class="card" id="summary-card"></div>
      <!-- Actions -->
      <div class="action-buttons" id="action-buttons">
        <button class="btn-primary" id="open-chat-btn" style="display:flex;align-items:center;gap:8px;">üí¨ Ask About Virginia</button>
        <button class="btn-secondary" id="reset-btn">‚Üê Analyze Another Role</button>
      </div>
    </div>
  </div>

  <!-- Chat Panel -->
  <div class="chat-panel hidden" id="chat-panel">
    <div class="chat-header">
      <div class="chat-header-left">
        <div class="chat-avatar">V</div>
        <div>
          <div class="chat-title">Virginia's AI Assistant</div>
          <div class="chat-subtitle">Ask about experience, skills & services</div>
        </div>
      </div>
      <button class="chat-minimize" id="minimize-chat">Minimize ‚Üì</button>
    </div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-input-row">
      <input class="chat-input" id="chat-input" type="text" placeholder="Ask about Virginia's experience..." />
      <button class="chat-send inactive" id="chat-send">Send</button>
    </div>
  </div>

  <!-- Chat FAB -->
  <button class="chat-fab hidden" id="chat-fab">üí¨</button>

  <script>
    // ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let analysis = null;
    let chatMessages = [];
    let chatLoading = false;

    // ‚îÄ‚îÄ‚îÄ Elements ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const $ = (id) => document.getElementById(id);
    const jobDesc = $("job-desc");
    const wordCount = $("word-count");
    const analyzeBtn = $("analyze-btn");
    const inputPhase = $("input-phase");
    const loadingPhase = $("loading-phase");
    const errorMsg = $("error-msg");
    const resultsPhase = $("results-phase");
    const container = $("container");
    const chatPanel = $("chat-panel");
    const chatMsgsEl = $("chat-messages");
    const chatInput = $("chat-input");
    const chatSendBtn = $("chat-send");
    const chatFab = $("chat-fab");

    // ‚îÄ‚îÄ‚îÄ Input Handling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    jobDesc.addEventListener("input", () => {
      const words = jobDesc.value.trim().split(/\s+/).filter(Boolean).length;
      wordCount.textContent = jobDesc.value.length > 0 ? `${words} words` : "";
      analyzeBtn.disabled = !jobDesc.value.trim();
    });

    // ‚îÄ‚îÄ‚îÄ Analyze ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    analyzeBtn.addEventListener("click", async () => {
      if (!jobDesc.value.trim()) return;
      inputPhase.classList.add("hidden");
      loadingPhase.classList.remove("hidden");
      errorMsg.classList.add("hidden");

      try {
        const res = await fetch("/.netlify/functions/analyze-fit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ jobDescription: jobDesc.value.trim() }),
        });
        const data = await res.json();

        if (!res.ok) throw new Error(data.error || "Analysis failed");

        analysis = data;
        renderResults(data);
        loadingPhase.classList.add("hidden");
        resultsPhase.classList.remove("hidden");
        chatFab.classList.remove("hidden");
      } catch (err) {
        loadingPhase.classList.add("hidden");
        inputPhase.classList.remove("hidden");
        errorMsg.textContent = err.message || "Analysis encountered an issue. Please try again.";
        errorMsg.classList.remove("hidden");
      }
    });

    // ‚îÄ‚îÄ‚îÄ Render Results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderResults(a) {
      // Score
      const color = a.overallFit >= 80 ? "var(--success)" : a.overallFit >= 60 ? "var(--coral)" : a.overallFit >= 40 ? "var(--warning)" : "var(--gap-color)";
      const circ = 2 * Math.PI * 54;
      $("score-card").innerHTML = `
        <div class="fit-meter">
          <svg width="140" height="140" viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="54" fill="none" stroke="var(--border)" stroke-width="7"/>
            <circle cx="60" cy="60" r="54" fill="none" stroke="${color}" stroke-width="7" stroke-linecap="round"
              stroke-dasharray="${circ}" stroke-dashoffset="${circ}" transform="rotate(-90 60 60)"
              style="transition: stroke-dashoffset 1.4s cubic-bezier(0.4,0,0.2,1);" id="score-circle"/>
            <text x="60" y="54" text-anchor="middle" fill="var(--slate)" font-size="30" font-weight="700" font-family="Outfit, sans-serif" id="score-text">0</text>
            <text x="60" y="72" text-anchor="middle" fill="var(--text-muted)" font-size="11" font-family="Outfit, sans-serif">/ 100</text>
          </svg>
          <span class="fit-label">${a.fitLabel}</span>
        </div>
        <p class="fit-headline">"${a.headline}"</p>
      `;
      // Animate score
      requestAnimationFrame(() => {
        const circle = $("score-circle");
        circle.style.strokeDashoffset = circ - (a.overallFit / 100) * circ;
        animateNumber($("score-text"), a.overallFit, 1400);
      });

      // Skills
      if (a.skillTags?.length) {
        $("skills-card").innerHTML = `
          <div class="section-label" style="color:var(--text-muted);">Skills Mapping</div>
          <div class="skill-tags">${a.skillTags.map(t => `<span class="skill-tag ${t.match}"><span class="dot"></span>${t.skill}</span>`).join("")}</div>
        `;
        $("skills-card").classList.remove("hidden");
      } else { $("skills-card").classList.add("hidden"); }

      // Strengths
      if (a.strengthAreas?.length) {
        $("strengths-card").innerHTML = `
          <div class="section-label" style="color:var(--success);"><span class="dot" style="background:var(--success);"></span>Strong Matches</div>
          ${a.strengthAreas.map(s => `<div class="match-item strong"><h4>${s.requirement}</h4><p>${s.evidence}</p></div>`).join("")}
        `;
        $("strengths-card").classList.remove("hidden");
      } else { $("strengths-card").classList.add("hidden"); }

      // Partial
      if (a.partialAreas?.length) {
        $("partial-card").innerHTML = `
          <div class="section-label" style="color:var(--warning);"><span class="dot" style="background:var(--warning);"></span>Transferable Experience</div>
          ${a.partialAreas.map(s => `<div class="match-item partial"><h4>${s.requirement}</h4><p>${s.evidence}</p></div>`).join("")}
        `;
        $("partial-card").classList.remove("hidden");
      } else { $("partial-card").classList.add("hidden"); }

      // Gaps
      if (a.gaps?.length) {
        $("gaps-card").innerHTML = `
          <div class="section-label" style="color:var(--text-muted);"><span class="dot" style="background:var(--gap-color);"></span>Gaps to Note</div>
          ${a.gaps.map(g => `<div class="match-item gap"><h4>${g.requirement}</h4><p>${g.note}</p></div>`).join("")}
        `;
        $("gaps-card").classList.remove("hidden");
      } else { $("gaps-card").classList.add("hidden"); }

      // Summary
      let summaryHtml = `<p style="font-size:15px;color:var(--text-light);line-height:1.75;margin-bottom:${a.overallFit >= 60 ? '18px' : '0'};">${a.summary}</p>`;
      if (a.overallFit >= 60) {
        summaryHtml += `<div class="cta-box">‚Üí ${a.callToAction}</div>`;
      }
      $("summary-card").innerHTML = summaryHtml;
    }

    function animateNumber(el, target, duration) {
      let start = null;
      const step = (ts) => {
        if (!start) start = ts;
        const p = Math.min((ts - start) / duration, 1);
        const eased = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.round(eased * target);
        if (p < 1) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    }

    // ‚îÄ‚îÄ‚îÄ Reset ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    $("reset-btn").addEventListener("click", () => {
      jobDesc.value = ""; wordCount.textContent = ""; analyzeBtn.disabled = true;
      analysis = null; chatMessages = [];
      resultsPhase.classList.add("hidden");
      chatPanel.classList.add("hidden");
      chatFab.classList.add("hidden");
      container.classList.remove("chat-open");
      inputPhase.classList.remove("hidden");
      errorMsg.classList.add("hidden");
    });

    // ‚îÄ‚îÄ‚îÄ Chat ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const SUGGESTED_QS = [
      "What's her LLM experience?",
      "Tell me about the Innovation Lab",
      "AI governance approach?",
      "Which industries?",
    ];

    function openChat() {
      chatPanel.classList.remove("hidden");
      chatFab.classList.add("hidden");
      $("open-chat-btn").classList.add("hidden");
      container.classList.add("chat-open");
      if (chatMessages.length === 0) {
        const greeting = analysis
          ? `Hi there! I see the fit analysis just came back at ${analysis.overallFit}%. I'd love to tell you more about Virginia's background in any of those areas. What catches your eye?`
          : `Hi! I'm Virginia's AI assistant at AI Tech Magic. I can share details about her experience leading AI/ML teams at Fortune 500 companies, building governance frameworks, rapid prototyping, and more. What would you like to know?`;
        chatMessages.push({ role: "assistant", content: greeting });
        renderChat(true);
      }
      chatInput.focus();
    }

    function closeChat() {
      chatPanel.classList.add("hidden");
      chatFab.classList.remove("hidden");
      $("open-chat-btn").classList.remove("hidden");
      container.classList.remove("chat-open");
    }

    function renderChat(showSuggestions = false) {
      let html = "";
      chatMessages.forEach(m => {
        const isUser = m.role === "user";
        html += `<div class="chat-bubble-row ${m.role}">`;
        if (!isUser) html += `<div class="chat-avatar sm" style="margin-right:10px;margin-top:2px;flex-shrink:0;">V</div>`;
        html += `<div class="chat-bubble ${m.role}">${escapeHtml(m.content)}</div></div>`;
      });
      if (chatLoading) {
        html += `<div class="chat-bubble-row assistant">
          <div class="chat-avatar sm" style="margin-right:10px;flex-shrink:0;">V</div>
          <div class="chat-bubble assistant"><div class="typing-dots"><span></span><span></span><span></span></div></div>
        </div>`;
      }
      if (showSuggestions && chatMessages.length === 1 && !chatLoading) {
        html += `<div class="suggested-qs">${SUGGESTED_QS.map(q =>
          `<button class="suggested-q" onclick="sendChat('${q}')">${q}</button>`
        ).join("")}</div>`;
      }
      chatMsgsEl.innerHTML = html;
      chatMsgsEl.scrollTop = chatMsgsEl.scrollHeight;
    }

    async function sendChat(msg) {
      const text = msg || chatInput.value.trim();
      if (!text || chatLoading) return;
      chatMessages.push({ role: "user", content: text });
      chatInput.value = "";
      updateSendBtn();
      chatLoading = true;
      renderChat();

      try {
        const res = await fetch("/.netlify/functions/chat-virginia", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: chatMessages,
            analysisContext: analysis ? {
              overallFit: analysis.overallFit,
              headline: analysis.headline,
              summary: analysis.summary,
            } : null,
          }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error);
        chatMessages.push({ role: "assistant", content: data.reply });
      } catch {
        chatMessages.push({ role: "assistant", content: "Having trouble connecting. Please try again in a moment." });
      } finally {
        chatLoading = false;
        renderChat();
        chatInput.focus();
      }
    }

    function updateSendBtn() {
      const has = chatInput.value.trim().length > 0;
      chatSendBtn.className = `chat-send ${has ? "active" : "inactive"}`;
    }

    function escapeHtml(str) {
      return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
    }

    // ‚îÄ‚îÄ‚îÄ Event Listeners ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    $("open-chat-btn").addEventListener("click", openChat);
    chatFab.addEventListener("click", openChat);
    $("minimize-chat").addEventListener("click", closeChat);
    chatInput.addEventListener("input", updateSendBtn);
    chatInput.addEventListener("keydown", (e) => { if (e.key === "Enter") sendChat(); });
    chatSendBtn.addEventListener("click", () => sendChat());
  </script>
</body>
</html>
